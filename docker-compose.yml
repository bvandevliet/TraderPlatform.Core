version: '3.4'

networks:
  TraderPlatform:
    driver: bridge

services:

  traderplatform.database:
    container_name: database
    image: mariadb:latest
    networks:
      - TraderPlatform

  # traderplatform.redis:
  #   image: redis:alpine
  #   networks:
  #     - TraderPlatform

  traderplatform.nginx:
    container_name: nginx
    image: nginx:alpine
    networks:
      - TraderPlatform

  traderplatform.engine:
    image: ${DOCKER_REGISTRY-}traderplatform-engine
    build:
      context: .
      dockerfile: TraderPlatform.Engine/Dockerfile
    environment:
      - ASPNETCORE_URLS=https://+:${PORT_ENGINE_SSL};http://+:${PORT_ENGINE}
    networks:
      - TraderPlatform

  traderplatform.api:
    image: ${DOCKER_REGISTRY-}traderplatform-api
    build:
      context: .
      dockerfile: TraderPlatform.API/Dockerfile
    env_file:
      - ./.env
    environment:
      - ASPNETCORE_URLS=https://+:${PORT_API_SSL};http://+:${PORT_API}
    networks:
      - TraderPlatform
    ports:
      - "${PORT_API}:${PORT_API}"
      - "${PORT_API_SSL}:${PORT_API_SSL}"

  traderplatform.daemon:
    image: ${DOCKER_REGISTRY-}traderplatform-daemon
    build:
      context: .
      dockerfile: TraderPlatform.Daemon/Dockerfile
    networks:
      - TraderPlatform
